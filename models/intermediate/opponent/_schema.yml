version: 2

models:
  - name: int__opponent_stats
    description: "Extended opponent team stats model combining game opponents and team boxscores"
    columns:
      - name: game_team_key
        description: "Unique identifier for team-game combination"
        tests:
          - unique
          - not_null
      - name: opp_def_rating
        description: "Opponent's defensive rating"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 80
              max_value: 140

  - name: int__position_defense_profile
    description: "Position-specific defensive metrics by opponent team"
    columns:
      - name: opponent_id
        tests:
          - not_null

  - name: int__game_opponents
      description: "Maps each game to the participating teams and identifies the opponent for each team. Unpivots schedule data to create one row per team per game (home/away perspectives). Serves as a central lookup for opponent IDs."
      config:
        tags: ["intermediate", "opponent"]

        - name: game_id
          description: "Unique identifier for the game."
          tests:
            - not_null

        - name: season_year
          description: "The year the season took place (e.g., '2023')."
          tests:
            - not_null

        - name: game_date
          description: "The date the game was played."
          tests:
            - not_null

        - name: team_id
          description: "The unique identifier for the team from this row's perspective."
          tests:
            - not_null
            # - relationships:
            #     to: ref('dim_teams') # Placeholder if/when a dim_teams exists
            #     field: team_id

        - name: opponent_id
          description: "The unique identifier for the opposing team in this game."
          tests:
            - not_null
            # - relationships:
            #     to: ref('dim_teams') # Placeholder if/when a dim_teams exists
            #     field: team_id

        - name: home_away
          description: "Indicates if the 'team_id' team was 'HOME' or 'AWAY' for this game."
          tests:
            - not_null
            - accepted_values:
                values: ['HOME', 'AWAY']
  - name: marts__player_game_prediction_features
    description: "Consolidated player-game prediction features"
    columns:
      - name: player_game_key
        tests:
          - unique
          - not_null
      - name: blended_pts_projection
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 80