version: 2

models:
  - name: int__player_props_normalized
    description: >
      Normalized player proposition bets with enriched player and team data.
      Includes implied probability calculations and no-vig metrics.
    config:
      materialized: incremental
      unique_key: prop_id
      tags: ['betting', 'intermediate', 'player_props']
    
    columns:
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      
      - name: player_slug
        description: URL-friendly identifier for the player
        tests:
          - not_null
      
      - name: game_date
        description: Date of the game
        tests:
          - not_null
      
      - name: game_id
        description: Unique identifier for the game
        tests:
          - not_null
      
      - name: opponent_id
        description: Identifier for the opponent team
      
      - name: prop_id
        description: Unique identifier for the proposition bet
        tests:
          - unique
          - not_null
      
      - name: offer_id
        description: Identifier for the betting offer
      
      - name: bp_event_id
        description: Event identifier from the data source
      
      - name: player_name
        description: Full name of the player
        tests:
          - not_null
      
      - name: team_tricode
        description: Three-letter team abbreviation
      
      - name: team_full_name
        description: Full name of the player's team
      
      - name: team_id
        description: Unique identifier for the player's team
      
      - name: market_id
        description: Identifier for the betting market type
        tests:
          - not_null
      
      - name: market
        description: Description of the betting market (e.g., Points, Rebounds, Assists)
        tests:
          - not_null
      
      - name: line
        description: The betting line value
        tests:
          - not_null
      
      - name: sportsbook
        description: Name of the sportsbook offering the bet
        tests:
          - not_null
      
      - name: over_odds
        description: American odds for the over bet
      
      - name: under_odds
        description: American odds for the under bet
      
      - name: source_file
        description: Source file where the data originated
      
      - name: prop_key
        description: Surrogate key combining player, market, date and line
        tests:
          - not_null
      
      - name: over_implied_prob
        description: Implied probability derived from over odds (0-1 scale)
      
      - name: under_implied_prob
        description: Implied probability derived from under odds (0-1 scale)
      
      - name: total_implied_prob
        description: Sum of over and under implied probabilities (>1 indicates vig)
      
      - name: over_no_vig_prob
        description: Fair probability for over after removing bookmaker margin
      
      - name: under_no_vig_prob
        description: Fair probability for under after removing bookmaker margin
      
      - name: hold_percentage
        description: Bookmaker's margin (vig) as a percentage
