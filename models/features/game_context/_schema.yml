version: 2

models:
  - name: game_context_features
    description: "Comprehensive game context features for NBA games, including team metrics, rest days, travel, and injuries"
    meta:
      owner: "NBA Analytics Team"
      contains_pii: false
      update_frequency: "daily"
    config:
      tags: ["game_context", "features", "ml"]
    columns:
      - name: game_id
        description: "Unique identifier for the game"
        tests:
          - unique
          - not_null
      
      - name: game_date
        description: "Date of the game"
        tests:
          - not_null
      
      - name: season_year
        description: "NBA season year"
        tests:
          - not_null
      
      - name: season_type
        description: "Type of season: Regular Season, Playoffs, etc."
        tests:
          - not_null
          - accepted_values:
              values: ["Regular Season", "Playoffs", "Play-In", "Preseason"]
      
      - name: home_team_id
        description: "Identifier for the home team"
        tests:
          - not_null
          - relationships:
              to: ref('stg__teams')
              field: team_id
      
      - name: away_team_id
        description: "Identifier for the away team"
        tests:
          - not_null
          - relationships:
              to: ref('stg__teams')
              field: team_id
      
      - name: home_rest_days
        description: "Number of days since the home team's last game"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
          - dbt_utils.accepted_range:
              max_value: 14
              where: "home_first_game_of_season = false"
      
      - name: away_rest_days
        description: "Number of days since the away team's last game"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
          - dbt_utils.accepted_range:
              max_value: 14
              where: "away_first_game_of_season = false"
      
      - name: home_team_travel_distance
        description: "Distance in miles traveled by the home team from their previous game location"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: away_team_travel_distance
        description: "Distance in miles traveled by the away team from their previous game location"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: home_back_to_back
        description: "Flag indicating if the home team is playing on the second night of a back-to-back"
      
      - name: away_back_to_back
        description: "Flag indicating if the away team is playing on the second night of a back-to-back"
      
      - name: home_injured_players_count
        description: "Number of injured players for the home team"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: away_injured_players_count
        description: "Number of injured players for the away team"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: home_injured_pts_impact
        description: "Total points per game from injured home team players"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: away_injured_pts_impact
        description: "Total points per game from injured away team players"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
      
      - name: rest_advantage
        description: "Difference in rest days between home and away teams (positive means home advantage)"
      
      - name: rest_advantage_team
        description: "Which team has the rest advantage: HOME, AWAY, or NONE"
        tests:
          - accepted_values:
              values: ["HOME", "AWAY", "NONE"]
      
      - name: home_off_rating_last_10
        description: "Home team's average offensive rating over the last 10 games"
      
      - name: away_def_rating_last_10
        description: "Away team's average defensive rating over the last 10 games"
      
      - name: home_off_vs_away_def_last_10
        description: "Difference between home team's offensive rating and away team's defensive rating"
      
      - name: away_off_vs_home_def_last_10
        description: "Difference between away team's offensive rating and home team's defensive rating"
      
      - name: expected_pace
        description: "Expected game pace based on both teams' recent pace averages"
      
      - name: is_playoff_game
        description: "Flag indicating if the game is a playoff game"
      
      - name: is_late_season
        description: "Flag indicating if the game is late in the regular season (game 70+)" 