version: 2

models:
  - name: team_season_defensive_summary
    description: "Calculates a comprehensive set of team-level defensive summary statistics aggregated over a season. Uses metrics from advanced, traditional, hustle, miscellaneous, and scoring team boxscores to provide a holistic view of defensive performance, including opponent shooting, scoring sources, rebounding, turnovers forced, and shot contesting."
    config:
      tags: ["features", "team_level", "defensive_summary"]
    columns:
      - name: team_season_key
        description: "Unique identifier for the team-season combination."
        tests:
          - unique
          - not_null

      - name: team_id
        description: "Unique identifier for the team."
        tests:
          - not_null

      - name: season_year
        description: "The season year (e.g., '2023')."
        tests:
          - not_null

      - name: game_date
        description: "The date of the last game included in this seasonal aggregation (used for incremental logic)."

      - name: avg_def_rating
        description: "Team's average defensive rating over the season (points allowed per 100 possessions)."

      - name: avg_opp_efg_pct
        description: "Average opponent effective field goal percentage over the season."

      - name: avg_opp_ts_pct
        description: "Average opponent true shooting percentage over the season."

      - name: avg_def_reb_pct
        description: "Team's average defensive rebound percentage over the season."
      - name: avg_opp_fg_pct
        description: "Average opponent field goal percentage over the season (calculated from total opponent FGM/FGA)."

      - name: avg_opp_fg3_pct
        description: "Average opponent 3-point field goal percentage over the season (calculated from total opponent FG3M/FG3A)."

      - name: avg_opp_ft_pct
        description: "Average opponent free throw percentage over the season (calculated from total opponent FTM/FTA)."

      - name: avg_opp_fta_rate
        description: "Average opponent free throw attempt rate (FTA/FGA) over the season."

      - name: avg_opp_tov_pct
        description: "Average opponent turnover percentage (turnovers per 100 possessions) over the season."

      - name: avg_def_reb_pct
        description: "Team's average defensive rebound percentage over the season."

      - name: avg_opp_pts_off_tov
        description: "Average points off turnovers allowed to opponents per game over the season."

      - name: avg_opp_pts_second_chance
        description: "Average second chance points allowed to opponents per game over the season."

      - name: avg_opp_pts_fastbreak
        description: "Average fast break points allowed to opponents per game over the season."

      - name: avg_opp_pts_paint
        description: "Average points in the paint allowed to opponents per game over the season."

      - name: avg_cont_2pt_per_game
        description: "Team's average contested 2-point shots per game over the season."

      - name: avg_cont_3pt_per_game
        description: "Team's average contested 3-point shots per game over the season."

      - name: avg_deflections_per_game
        description: "Team's average deflections per game over the season."

      - name: avg_charges_drawn_per_game
        description: "Team's average charges drawn per game over the season."

      - name: avg_def_loose_balls_rec_per_game
        description: "Team's average defensive loose balls recovered per game over the season."

      - name: avg_blk_per_game
        description: "Team's average blocks per game over the season."

      - name: avg_stl_per_game
        description: "Team's average steals per game over the season."

      - name: avg_opp_tov_per_game
        description: "Average turnovers committed by opponents per game over the season."

      - name: avg_pf_per_game
        description: "Team's average personal fouls per game over the season."

      # Opponent Scoring Distribution
      - name: avg_opp_pct_fga_2pt
        description: "Average percentage of opponent field goal attempts that were 2-pointers over the season."

      - name: avg_opp_pct_fga_3pt
        description: "Average percentage of opponent field goal attempts that were 3-pointers over the season."

      - name: avg_opp_pct_pts_2pt
        description: "Average percentage of opponent points scored from 2-point field goals over the season."

      - name: avg_opp_pct_pts_3pt
        description: "Average percentage of opponent points scored from 3-point field goals over the season."

      - name: avg_opp_pct_pts_fastbreak
        description: "Average percentage of opponent points scored from fast breaks over the season."

      - name: avg_opp_pct_pts_ft
        description: "Average percentage of opponent points scored from free throws over the season."

      - name: avg_opp_pct_pts_off_tov
        description: "Average percentage of opponent points scored off turnovers over the season."

      - name: avg_opp_pct_pts_paint
        description: "Average percentage of opponent points scored in the paint over the season." 