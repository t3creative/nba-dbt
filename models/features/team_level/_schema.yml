version: 2

models:
  - name: team_rolling_stats
    description: "Calculates rolling N-game averages, standard deviations, and lag-1 values for various team statistics."
    config:
      materialized: incremental
      unique_key: team_game_key
      incremental_strategy: delete+insert
      tags: ['intermediate', 'stats']
      indexes:
        - columns: ['team_game_key']
          unique: True
        - columns: ['game_id']
        - columns: ['team_id']
        - columns: ['opponent_id']
        - columns: ['game_date']
        - columns: ['season_year']
    columns:
      # Identifiers
      - name: team_game_key
        description: "Unique identifier for team-game combination"
        tests:
          - unique
          - not_null
      - name: game_id
        description: "Unique identifier for the game"
        tests:
          - not_null
      - name: team_id
        description: "Unique identifier for the team"
        tests:
          - not_null
      - name: game_date
        description: "Date of the game"
        tests:
          - not_null
      - name: season_year
        description: "Season year"
      - name: opponent_id
        description: "Unique identifier for the opposing team"

      # --- Rolling Stats (Avg, StdDev, Lag) ---
      # The rolling window size (N) is defined by the 'rolling_window_games' variable (default 10)

      # Traditional
      - name: min_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of minutes played over the previous {{ var('rolling_window_games', 10) }} games."
      - name: min_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of minutes played over the previous {{ var('rolling_window_games', 10) }} games."
      - name: min_lag_1g
        description: "Minutes played in the previous game."
      - name: fgm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of field goals made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fgm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of field goals made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fgm_lag_1g
        description: "Field goals made in the previous game."
      - name: fga_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of field goals attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fga_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of field goals attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fga_lag_1g
        description: "Field goals attempted in the previous game."
      - name: fg_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of field goal percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of field goal percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg_pct_lag_1g
        description: "Field goal percentage in the previous game."
      - name: fg3m_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of 3-point field goals made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3m_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of 3-point field goals made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3m_lag_1g
        description: "3-point field goals made in the previous game."
      - name: fg3a_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of 3-point field goals attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3a_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of 3-point field goals attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3a_lag_1g
        description: "3-point field goals attempted in the previous game."
      - name: fg3_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of 3-point percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of 3-point percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fg3_pct_lag_1g
        description: "3-point percentage in the previous game."
      - name: ftm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of free throws made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ftm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of free throws made over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ftm_lag_1g
        description: "Free throws made in the previous game."
      - name: fta_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of free throws attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fta_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of free throws attempted over the previous {{ var('rolling_window_games', 10) }} games."
      - name: fta_lag_1g
        description: "Free throws attempted in the previous game."
      - name: ft_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of free throw percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ft_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of free throw percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ft_pct_lag_1g
        description: "Free throw percentage in the previous game."
      - name: off_reb_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of offensive rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_reb_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of offensive rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_reb_lag_1g
        description: "Offensive rebounds in the previous game."
      - name: def_reb_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of defensive rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_reb_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of defensive rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_reb_lag_1g
        description: "Defensive rebounds in the previous game."
      - name: reb_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of total rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: reb_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of total rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: reb_lag_1g
        description: "Total rebounds in the previous game."
      - name: ast_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of assists over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of assists over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_lag_1g
        description: "Assists in the previous game."
      - name: stl_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of steals over the previous {{ var('rolling_window_games', 10) }} games."
      - name: stl_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of steals over the previous {{ var('rolling_window_games', 10) }} games."
      - name: stl_lag_1g
        description: "Steals in the previous game."
      - name: blk_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of blocks over the previous {{ var('rolling_window_games', 10) }} games."
      - name: blk_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of blocks over the previous {{ var('rolling_window_games', 10) }} games."
      - name: blk_lag_1g
        description: "Blocks in the previous game."
      - name: tov_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tov_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tov_lag_1g
        description: "Turnovers in the previous game."
      - name: pf_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of personal fouls over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pf_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of personal fouls over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pf_lag_1g
        description: "Personal fouls in the previous game."
      - name: pts_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_lag_1g
        description: "Points scored in the previous game."
      - name: plus_minus_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of plus-minus over the previous {{ var('rolling_window_games', 10) }} games."
      - name: plus_minus_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of plus-minus over the previous {{ var('rolling_window_games', 10) }} games."
      - name: plus_minus_lag_1g
        description: "Plus-minus in the previous game."

      # Advanced
      - name: est_off_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated offensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_off_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated offensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_off_rating_lag_1g
        description: "Estimated offensive rating in the previous game."
      - name: off_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of offensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of offensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_rating_lag_1g
        description: "Offensive rating in the previous game."
      - name: est_def_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated defensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_def_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated defensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_def_rating_lag_1g
        description: "Estimated defensive rating in the previous game."
      - name: def_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of defensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of defensive rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_rating_lag_1g
        description: "Defensive rating in the previous game."
      - name: est_net_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated net rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_net_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated net rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_net_rating_lag_1g
        description: "Estimated net rating in the previous game."
      - name: net_rating_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of net rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: net_rating_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of net rating over the previous {{ var('rolling_window_games', 10) }} games."
      - name: net_rating_lag_1g
        description: "Net rating in the previous game."
      - name: ast_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of assist percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of assist percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_pct_lag_1g
        description: "Assist percentage in the previous game."
      - name: ast_to_tov_ratio_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of assist-to-turnover ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_to_tov_ratio_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of assist-to-turnover ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_to_tov_ratio_lag_1g
        description: "Assist-to-turnover ratio in the previous game."
      - name: ast_ratio_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of assist ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_ratio_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of assist ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ast_ratio_lag_1g
        description: "Assist ratio in the previous game."
      - name: off_reb_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of offensive rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_reb_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of offensive rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_reb_pct_lag_1g
        description: "Offensive rebound percentage in the previous game."
      - name: def_reb_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of defensive rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_reb_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of defensive rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_reb_pct_lag_1g
        description: "Defensive rebound percentage in the previous game."
      - name: reb_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of total rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: reb_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of total rebound percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: reb_pct_lag_1g
        description: "Total rebound percentage in the previous game."
      - name: est_team_tov_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated team turnover percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_team_tov_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated team turnover percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_team_tov_pct_lag_1g
        description: "Estimated team turnover percentage in the previous game."
      - name: tov_ratio_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of turnover ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tov_ratio_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of turnover ratio over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tov_ratio_lag_1g
        description: "Turnover ratio in the previous game."
      - name: eff_fg_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of effective field goal percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: eff_fg_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of effective field goal percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: eff_fg_pct_lag_1g
        description: "Effective field goal percentage in the previous game."
      - name: ts_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of true shooting percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ts_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of true shooting percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: ts_pct_lag_1g
        description: "True shooting percentage in the previous game."
      - name: usage_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of usage percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: usage_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of usage percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: usage_pct_lag_1g
        description: "Usage percentage in the previous game."
      - name: est_usage_pct_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated usage percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_usage_pct_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated usage percentage over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_usage_pct_lag_1g
        description: "Estimated usage percentage in the previous game."
      - name: est_pace_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of estimated pace over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_pace_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of estimated pace over the previous {{ var('rolling_window_games', 10) }} games."
      - name: est_pace_lag_1g
        description: "Estimated pace in the previous game."
      - name: pace_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of pace over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pace_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of pace over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pace_lag_1g
        description: "Pace in the previous game."
      - name: pace_per_40_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of pace per 40 minutes over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pace_per_40_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of pace per 40 minutes over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pace_per_40_lag_1g
        description: "Pace per 40 minutes in the previous game."
      - name: possessions_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of possessions over the previous {{ var('rolling_window_games', 10) }} games."
      - name: possessions_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of possessions over the previous {{ var('rolling_window_games', 10) }} games."
      - name: possessions_lag_1g
        description: "Possessions in the previous game."
      - name: pie_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of Player Impact Estimate (PIE) over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pie_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of Player Impact Estimate (PIE) over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pie_lag_1g
        description: "Player Impact Estimate (PIE) in the previous game."

      # Hustle
      - name: cont_shots_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of contested shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_shots_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of contested shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_shots_lag_1g
        description: "Contested shots in the previous game."
      - name: cont_2pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of contested 2-point shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_2pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of contested 2-point shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_2pt_lag_1g
        description: "Contested 2-point shots in the previous game."
      - name: cont_3pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of contested 3-point shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_3pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of contested 3-point shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: cont_3pt_lag_1g
        description: "Contested 3-point shots in the previous game."
      - name: deflections_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of deflections over the previous {{ var('rolling_window_games', 10) }} games."
      - name: deflections_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of deflections over the previous {{ var('rolling_window_games', 10) }} games."
      - name: deflections_lag_1g
        description: "Deflections in the previous game."
      - name: charges_drawn_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of charges drawn over the previous {{ var('rolling_window_games', 10) }} games."
      - name: charges_drawn_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of charges drawn over the previous {{ var('rolling_window_games', 10) }} games."
      - name: charges_drawn_lag_1g
        description: "Charges drawn in the previous game."
      - name: screen_ast_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of screen assists over the previous {{ var('rolling_window_games', 10) }} games."
      - name: screen_ast_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of screen assists over the previous {{ var('rolling_window_games', 10) }} games."
      - name: screen_ast_lag_1g
        description: "Screen assists in the previous game."
      - name: screen_ast_pts_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of screen assist points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: screen_ast_pts_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of screen assist points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: screen_ast_pts_lag_1g
        description: "Screen assist points in the previous game."
      - name: off_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of offensive loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of offensive loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_loose_balls_rec_lag_1g
        description: "Offensive loose balls recovered in the previous game."
      - name: def_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of defensive loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of defensive loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_loose_balls_rec_lag_1g
        description: "Defensive loose balls recovered in the previous game."
      - name: tot_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of total loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tot_loose_balls_rec_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of total loose balls recovered over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tot_loose_balls_rec_lag_1g
        description: "Total loose balls recovered in the previous game."
      - name: off_box_outs_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of offensive box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_box_outs_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of offensive box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: off_box_outs_lag_1g
        description: "Offensive box outs in the previous game."
      - name: def_box_outs_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of defensive box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_box_outs_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of defensive box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: def_box_outs_lag_1g
        description: "Defensive box outs in the previous game."
      - name: box_out_team_reb_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of box outs leading to team rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: box_out_team_reb_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of box outs leading to team rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: box_out_team_reb_lag_1g
        description: "Box outs leading to team rebounds in the previous game."
      - name: box_out_player_reb_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of box outs leading to player rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: box_out_player_reb_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of box outs leading to player rebounds over the previous {{ var('rolling_window_games', 10) }} games."
      - name: box_out_player_reb_lag_1g
        description: "Box outs leading to player rebounds in the previous game."
      - name: tot_box_outs_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of total box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tot_box_outs_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of total box outs over the previous {{ var('rolling_window_games', 10) }} games."
      - name: tot_box_outs_lag_1g
        description: "Total box outs in the previous game."

      # Misc
      - name: pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_off_tov_lag_1g
        description: "Points off turnovers in the previous game."
      - name: second_chance_pts_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of 2nd chance points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: second_chance_pts_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of 2nd chance points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: second_chance_pts_lag_1g
        description: "2nd chance points in the previous game."
      - name: pts_fastbreak_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of fastbreak points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_fastbreak_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of fastbreak points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_fastbreak_lag_1g
        description: "Fastbreak points in the previous game."
      - name: pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of points in the paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of points in the paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pts_in_paint_lag_1g
        description: "Points in the paint in the previous game."
      - name: opp_pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of opponent points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of opponent points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_pts_off_tov_lag_1g
        description: "Opponent points off turnovers in the previous game."
      - name: opp_second_chance_pts_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of opponent 2nd chance points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_second_chance_pts_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of opponent 2nd chance points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_second_chance_pts_lag_1g
        description: "Opponent 2nd chance points in the previous game."
      - name: opp_fastbreak_pts_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of opponent fastbreak points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_fastbreak_pts_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of opponent fastbreak points over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_fastbreak_pts_lag_1g
        description: "Opponent fastbreak points in the previous game."
      - name: opp_pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of opponent points in the paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of opponent points in the paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: opp_pts_in_paint_lag_1g
        description: "Opponent points in the paint in the previous game."

      # Scoring
      - name: pct_fg_2pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of FGM that are 2pt over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_fg_2pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of FGM that are 2pt over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_fg_2pt_lag_1g
        description: "% of FGM that are 2pt in the previous game."
      - name: pct_fg_3pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of FGM that are 3pt over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_fg_3pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of FGM that are 3pt over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_fg_3pt_lag_1g
        description: "% of FGM that are 3pt in the previous game."
      - name: pct_pts_2pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from 2pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_2pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from 2pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_2pt_lag_1g
        description: "% of points from 2pt shots in the previous game."
      - name: pct_pts_2pt_mr_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from mid-range 2pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_2pt_mr_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from mid-range 2pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_2pt_mr_lag_1g
        description: "% of points from mid-range 2pt shots in the previous game."
      - name: pct_pts_3pt_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from 3pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_3pt_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from 3pt shots over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_3pt_lag_1g
        description: "% of points from 3pt shots in the previous game."
      - name: pct_pts_fastbreak_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from fastbreaks over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_fastbreak_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from fastbreaks over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_fastbreak_lag_1g
        description: "% of points from fastbreaks in the previous game."
      - name: pct_pts_ft_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from free throws over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_ft_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from free throws over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_ft_lag_1g
        description: "% of points from free throws in the previous game."
      - name: pct_pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_off_tov_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from points off turnovers over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_off_tov_lag_1g
        description: "% of points from points off turnovers in the previous game."
      - name: pct_pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of points from points in paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_in_paint_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of points from points in paint over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_pts_in_paint_lag_1g
        description: "% of points from points in paint in the previous game."
      - name: pct_ast_2pm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of assisted 2pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_2pm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of assisted 2pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_2pm_lag_1g
        description: "% of assisted 2pt FGM in the previous game."
      - name: pct_unast_2pm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of unassisted 2pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_2pm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of unassisted 2pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_2pm_lag_1g
        description: "% of unassisted 2pt FGM in the previous game."
      - name: pct_ast_3pm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of assisted 3pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_3pm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of assisted 3pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_3pm_lag_1g
        description: "% of assisted 3pt FGM in the previous game."
      - name: pct_unast_3pm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of unassisted 3pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_3pm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of unassisted 3pt FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_3pm_lag_1g
        description: "% of unassisted 3pt FGM in the previous game."
      - name: pct_ast_fgm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of assisted FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_fgm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of assisted FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_ast_fgm_lag_1g
        description: "% of assisted FGM in the previous game."
      - name: pct_unast_fgm_roll_{{ var('rolling_window_games', 10) }}g_avg
        description: "Rolling average of % of unassisted FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_fgm_roll_{{ var('rolling_window_games', 10) }}g_stddev
        description: "Rolling standard deviation of % of unassisted FGM over the previous {{ var('rolling_window_games', 10) }} games."
      - name: pct_unast_fgm_lag_1g
        description: "% of unassisted FGM in the previous game."

      # Timestamps for Incremental
      - name: updated_at
        description: "Timestamp of the last update from the source boxscore data."

  - name: team_season_defensive_summary
    description: "Calculates a comprehensive set of team-level defensive summary statistics aggregated over a season. Uses metrics from advanced, traditional, hustle, miscellaneous, and scoring team boxscores to provide a holistic view of defensive performance, including opponent shooting, scoring sources, rebounding, turnovers forced, and shot contesting."
    config:
      tags: ["features", "team_level", "defensive_summary"]
    columns:
      - name: team_season_key
        description: "Unique identifier for the team-season combination."
        tests:
          - unique
          - not_null

      - name: team_id
        description: "Unique identifier for the team."
        tests:
          - not_null

      - name: season_year
        description: "The season year (e.g., '2023')."
        tests:
          - not_null

      - name: game_date
        description: "The date of the last game included in this seasonal aggregation (used for incremental logic)."

      - name: avg_def_rating
        description: "Team's average defensive rating over the season (points allowed per 100 possessions)."

      - name: avg_opp_efg_pct
        description: "Average opponent effective field goal percentage over the season."

      - name: avg_opp_ts_pct
        description: "Average opponent true shooting percentage over the season."

      - name: avg_def_reb_pct
        description: "Team's average defensive rebound percentage over the season."
      - name: avg_opp_fg_pct
        description: "Average opponent field goal percentage over the season (calculated from total opponent FGM/FGA)."

      - name: avg_opp_fg3_pct
        description: "Average opponent 3-point field goal percentage over the season (calculated from total opponent FG3M/FG3A)."

      - name: avg_opp_ft_pct
        description: "Average opponent free throw percentage over the season (calculated from total opponent FTM/FTA)."

      - name: avg_opp_fta_rate
        description: "Average opponent free throw attempt rate (FTA/FGA) over the season."

      - name: avg_opp_tov_pct
        description: "Average opponent turnover percentage (turnovers per 100 possessions) over the season."

      - name: avg_def_reb_pct
        description: "Team's average defensive rebound percentage over the season."

      - name: avg_opp_pts_off_tov
        description: "Average points off turnovers allowed to opponents per game over the season."

      - name: avg_opp_second_chance_pts
        description: "Average second chance points allowed to opponents per game over the season."

      - name: avg_opp_fastbreak_pts
        description: "Average fast break points allowed to opponents per game over the season."

      - name: avg_opp_pts_in_paint
        description: "Average points in the paint allowed to opponents per game over the season."

      - name: avg_cont_2pt_per_game
        description: "Team's average contested 2-point shots per game over the season."

      - name: avg_cont_3pt_per_game
        description: "Team's average contested 3-point shots per game over the season."

      - name: avg_deflections_per_game
        description: "Team's average deflections per game over the season."

      - name: avg_charges_drawn_per_game
        description: "Team's average charges drawn per game over the season."

      - name: avg_def_loose_balls_rec_per_game
        description: "Team's average defensive loose balls recovered per game over the season."

      - name: avg_blk_per_game
        description: "Team's average blocks per game over the season."

      - name: avg_stl_per_game
        description: "Team's average steals per game over the season."

      - name: avg_opp_tov_per_game
        description: "Average turnovers committed by opponents per game over the season."

      - name: avg_pf_per_game
        description: "Team's average personal fouls per game over the season."

      # Opponent Scoring Distribution
      - name: avg_opp_pct_fga_2pt
        description: "Average percentage of opponent field goal attempts that were 2-pointers over the season."

      - name: avg_opp_pct_fga_3pt
        description: "Average percentage of opponent field goal attempts that were 3-pointers over the season."

      - name: avg_opp_pct_pts_2pt
        description: "Average percentage of opponent points scored from 2-point field goals over the season."

      - name: avg_opp_pct_pts_3pt
        description: "Average percentage of opponent points scored from 3-point field goals over the season."

      - name: avg_opp_pct_pts_fastbreak
        description: "Average percentage of opponent points scored from fast breaks over the season."

      - name: avg_opp_pct_pts_ft
        description: "Average percentage of opponent points scored from free throws over the season."

      - name: avg_opp_pct_pts_off_tov
        description: "Average percentage of opponent points scored off turnovers over the season."

      - name: avg_opp_pct_pts_in_paint
        description: "Average percentage of opponent points scored in the paint over the season." 