version: 2

models:
  - name: pbp__game_pace
    description: >
      Feature model that analyzes the game pace through possession tracking.
      Calculates total possessions, possession duration, scoring efficiency,
      and pace metrics to characterize the tempo and flow of basketball games.
    config:
      tags: ['features', 'play_by_play', 'game_level']
      materialized: incremental
    columns:
      - name: game_id
        description: Unique identifier for the game
        tests:
          - not_null
          - unique
      - name: total_possessions
        description: Total number of possessions in the game
        tests:
          - not_null
      - name: avg_possession_duration
        description: Average time in seconds per possession across the game
      - name: possessions_per_48
        description: Pace metric showing number of possessions scaled to a 48-minute game
        tests:
          - not_null
      - name: scoring_efficiency
        description: Ratio of scoring possessions to total possessions
      - name: home_team_id
        description: Unique identifier for the home team
        tests:
          - not_null
      - name: away_team_id
        description: Unique identifier for the away team
        tests:
          - not_null
      - name: home_team_possessions
        description: Number of possessions by the home team
      - name: away_team_possessions
        description: Number of possessions by the away team
      - name: home_avg_possession_duration
        description: Average time in seconds per possession for the home team
      - name: away_avg_possession_duration
        description: Average time in seconds per possession for the away team
      - name: possession_variability_diff
        description: Difference in possession duration variability between home and away teams
      - name: scoring_efficiency_diff
        description: Difference in scoring efficiency between home and away teams
      - name: game_pace_category
        description: Categorical description of game pace (FAST_PACED, MODERATE, SLOW_PACED, etc.)
      - name: pace_consistency
        description: Pattern of pace throughout the game (CONSISTENT_PACE, DECREASING_PACE, etc.)

  - name: pbp__game_momentum
    description: >
      Feature model tracking game momentum by analyzing scoring runs, point differentials,
      and momentum shifts throughout basketball games. Identifies patterns like comebacks,
      blowouts, and tight contests by quarter-by-quarter scoring comparisons.
    config:
      tags: ['features', 'play_by_play', 'game_level']
      materialized: incremental
    columns:
      - name: game_id
        description: Unique identifier for the game
        tests:
          - not_null
          - unique
      - name: home_team_id
        description: Unique identifier for the home team
        tests:
          - not_null
      - name: home_team_code
        description: Three-letter code for the home team
      - name: away_team_id
        description: Unique identifier for the away team
        tests:
          - not_null
      - name: away_team_code
        description: Three-letter code for the away team
      - name: home_max_consecutive_scores
        description: Maximum number of consecutive scoring events by the home team
      - name: away_max_consecutive_scores
        description: Maximum number of consecutive scoring events by the away team
      - name: home_max_point_run
        description: Maximum points scored in a run by the home team
      - name: away_max_point_run
        description: Maximum points scored in a run by the away team
      - name: home_avg_time_between_scores
        description: Average time between scoring events for the home team
      - name: away_avg_time_between_scores
        description: Average time between scoring events for the away team
      - name: home_scoring_consistency
        description: Standard deviation of time between scores for home team (lower = more consistent)
      - name: away_scoring_consistency
        description: Standard deviation of time between scores for away team (lower = more consistent)
      - name: q1_score_diff
        description: Point differential (home - away) in the first quarter
      - name: q2_score_diff
        description: Point differential (home - away) in the second quarter
      - name: q3_score_diff
        description: Point differential (home - away) in the third quarter
      - name: q4_score_diff
        description: Point differential (home - away) in the fourth quarter
      - name: ot_score_diff
        description: Point differential (home - away) in overtime periods
      - name: momentum_shift_diff
        description: Difference in significant scoring runs between home and away teams
      - name: game_flow_pattern
        description: Categorical description of the game flow (TIGHT_CONTEST, BLOWOUT, COMEBACK, etc.)

  - name: pbp__player_shooting
    description: >
      Feature model analyzing detailed player shooting metrics including shooting percentages
      by zone, clutch performance, and advanced efficiency metrics like true shooting percentage.
      Provides comprehensive shot distribution and efficiency data for player evaluation.
    config:
      tags: ['features', 'play_by_play', 'player_level']
      materialized: incremental
    columns:
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      - name: game_id
        description: Unique identifier for the game
        tests:
          - not_null
      - name: player_name
        description: Full name of the player
      - name: total_shots
        description: Total shot attempts including field goals and free throws
      - name: made_shots
        description: Total shots made including field goals and free throws
      - name: total_points
        description: Total points scored from all shots
      - name: three_pt_attempts
        description: Number of three-point shot attempts
      - name: three_pt_made
        description: Number of three-point shots made
      - name: two_pt_attempts
        description: Number of two-point shot attempts
      - name: two_pt_made
        description: Number of two-point shots made
      - name: ft_attempts
        description: Number of free throw attempts
      - name: ft_made
        description: Number of free throws made
      - name: at_rim_attempts
        description: Number of shot attempts at the rim (0-5 feet)
      - name: at_rim_made
        description: Number of shots made at the rim
      - name: mid_range_attempts
        description: Number of mid-range shot attempts (5-15 feet)
      - name: mid_range_made
        description: Number of mid-range shots made
      - name: long_mid_attempts
        description: Number of long mid-range shot attempts (15-23.75 feet)
      - name: long_mid_made
        description: Number of long mid-range shots made
      - name: three_pt_zone_attempts
        description: Number of three-point shot attempts by zone definition
      - name: three_pt_zone_made
        description: Number of three-point shots made by zone definition
      - name: clutch_attempts
        description: Shot attempts in clutch time (last 2 minutes of close games)
      - name: clutch_made
        description: Shots made in clutch time
      - name: avg_shot_distance
        description: Average distance of shot attempts in feet
      - name: avg_time_between_shots
        description: Average time between shot attempts in seconds
      - name: fg_pct
        description: Field goal percentage (made shots / total shots)
      - name: three_pt_pct
        description: Three-point percentage (three-point made / three-point attempts)
      - name: two_pt_pct
        description: Two-point percentage (two-point made / two-point attempts)
      - name: ft_pct
        description: Free throw percentage (free throws made / free throw attempts)
      - name: at_rim_pct
        description: Field goal percentage on shots at the rim
      - name: mid_range_pct
        description: Field goal percentage on mid-range shots
      - name: long_mid_pct
        description: Field goal percentage on long mid-range shots
      - name: three_pt_zone_pct
        description: Field goal percentage on three-point shots by zone definition
      - name: clutch_fg_pct
        description: Field goal percentage in clutch situations
      - name: points_per_shot
        description: Average points scored per shot attempt
      - name: effective_fg_pct
        description: Effective field goal percentage accounting for three-point value
      - name: true_shooting_pct
        description: True shooting percentage accounting for field goals and free throws
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          column_list: ['game_id', 'player_id']

  - name: pbp__player_performance_metrics
    description: >
      Feature model providing comprehensive player performance metrics beyond traditional box scores.
      Includes advanced statistics like true shooting percentage, game score, and per-36-minute
      projections to evaluate player impact and efficiency.
    config:
      tags: ['features', 'play_by_play', 'player_level']
      materialized: incremental
    columns:
      - name: game_id
        description: Unique identifier for the game
        tests:
          - not_null
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      - name: player_name
        description: Full name of the player
      - name: team_id
        description: Unique identifier for the player's team
      - name: team_code
        description: Three-letter code for the player's team
      - name: field_goals_made
        description: Number of field goals made
      - name: field_goals_missed
        description: Number of field goals missed
      - name: free_throws_made
        description: Number of free throws made
      - name: free_throws_missed
        description: Number of free throws missed
      - name: rebounds
        description: Total rebounds
      - name: turnovers
        description: Total turnovers
      - name: assists
        description: Total assists
      - name: steals
        description: Total steals
      - name: blocks
        description: Total blocks
      - name: fouls
        description: Total fouls
      - name: total_points
        description: Total points scored
      - name: max_period
        description: Maximum period the player appeared in
      - name: minutes_played
        description: Estimated minutes played based on event data
      - name: clutch_shots_made
        description: Field goals made in clutch time
      - name: clutch_shots_missed
        description: Field goals missed in clutch time
      - name: q1_points
        description: Points scored in first quarter
      - name: q2_points
        description: Points scored in second quarter
      - name: q3_points
        description: Points scored in third quarter
      - name: q4_points
        description: Points scored in fourth quarter
      - name: ot_points
        description: Points scored in overtime periods
      - name: blowout_scores
        description: Scoring events during blowout situations (>10 point difference)
      - name: close_game_scores
        description: Scoring events during close game situations (<= 5 point difference)
      - name: fg_attempts
        description: Total field goal attempts
      - name: fg_pct
        description: Field goal percentage
      - name: ft_attempts
        description: Total free throw attempts
      - name: ft_pct
        description: Free throw percentage
      - name: game_score
        description: Game Score metric (combines positive and negative stats)
      - name: true_shooting_pct
        description: True shooting percentage accounting for field goals and free throws
      - name: points_per_36
        description: Points projected to 36 minutes of playing time
      - name: assists_per_36
        description: Assists projected to 36 minutes of playing time
      - name: rebounds_per_36
        description: Rebounds projected to 36 minutes of playing time
      - name: scoring_variance
        description: Difference between highest and lowest scoring quarters
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          column_list: ['game_id', 'player_id']
