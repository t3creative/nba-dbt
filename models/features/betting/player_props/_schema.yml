version: 2

models:
  - name: player_prop_market_features
    description: >
      Aggregated statistical features for player-market combinations, providing insights into
      historical line distributions, odds variations, and market positioning.
    config:
      tags: ['betting', 'features', 'player_props', 'ml']
    columns:
      - name: feature_key
        description: Unique surrogate key for each player-market combination
        tests:
          - unique
          - not_null
      
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      
      - name: player_name_standardized
        description: Standardized player name
        tests:
          - not_null
      
      - name: market_id
        description: Unique identifier for the betting market
        tests:
          - not_null
      
      - name: market
        description: Description of the betting market (e.g., Points O/U, Rebounds O/U)
        tests:
          - not_null
      
      - name: total_props
        description: Total number of prop bets for this player-market combination
      
      - name: total_games
        description: Total number of games with props for this player-market
      
      - name: sportsbooks_count
        description: Number of distinct sportsbooks offering this player-market
      
      - name: avg_line
        description: Average line value across all sportsbooks and games
      
      - name: median_line
        description: Median line value across all sportsbooks and games
      
      - name: stddev_line
        description: Standard deviation of line values, indicating volatility
      
      - name: min_line
        description: Minimum line value observed
      
      - name: max_line
        description: Maximum line value observed
      
      - name: market_p10_line
        description: 10th percentile line value for this market across all players
      
      - name: market_p25_line
        description: 25th percentile line value for this market across all players
      
      - name: market_p75_line
        description: 75th percentile line value for this market across all players
      
      - name: market_p90_line
        description: 90th percentile line value for this market across all players
      
      - name: line_position
        description: Classification of where this player's average line sits in the market distribution
      
      - name: avg_over_odds
        description: Average odds for the over bet
      
      - name: avg_under_odds
        description: Average odds for the under bet
      
      - name: avg_over_implied_prob
        description: Average implied probability for the over bet
      
      - name: avg_under_implied_prob
        description: Average implied probability for the under bet
      
      - name: avg_no_vig_over_prob
        description: Average no-vig probability for the over bet (removing bookmaker margin)
      
      - name: avg_no_vig_under_prob
        description: Average no-vig probability for the under bet (removing bookmaker margin)
      
      - name: avg_vig_pct
        description: Average bookmaker margin (vig) percentage
      
      - name: line_vs_market_avg
        description: Difference between player's average line and the market average
      
      - name: first_appearance
        description: Date of first appearance in the dataset
      
      - name: last_appearance
        description: Date of most recent appearance in the dataset
      
      - name: feature_date
        description: Date when features were calculated
        tests:
          - not_null

  - name: player_prop_market_sportsbook_features
    description: >
      Features analyzing how different sportsbooks price props for specific player-market combinations,
      identifying biases and potential value opportunities.
    config:
      tags: ['betting', 'features', 'player_props', 'sportsbooks', 'ml']
    columns:
      - name: feature_key
        description: Unique surrogate key for each player-market-sportsbook combination
        tests:
          - unique
          - not_null
      
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      
      - name: player_name_standardized
        description: Standardized player name
        tests:
          - not_null
      
      - name: market_id
        description: Unique identifier for the betting market
        tests:
          - not_null
      
      - name: market
        description: Description of the betting market (e.g., Points O/U, Rebounds O/U)
        tests:
          - not_null
      
      - name: sportsbook
        description: Name of the sportsbook
        tests:
          - not_null
      
      - name: sample_size
        description: Number of prop bets for this player-market-sportsbook combination
      
      - name: game_count
        description: Number of distinct games with props for this player-market-sportsbook
      
      - name: avg_line_vs_consensus
        description: Average difference between sportsbook line and consensus line
      
      - name: stddev_line_vs_consensus
        description: Standard deviation of the difference between sportsbook and consensus lines
      
      - name: median_line_vs_consensus
        description: Median difference between sportsbook line and consensus line
      
      - name: pct_higher_than_consensus
        description: Percentage of time this sportsbook sets line higher than consensus
      
      - name: pct_lower_than_consensus
        description: Percentage of time this sportsbook sets line lower than consensus
      
      - name: line_positioning_pattern
        description: Classification of sportsbook's tendency to set lines relative to consensus
      
      - name: avg_over_odds_vs_consensus
        description: Average difference in over odds compared to consensus
      
      - name: avg_under_odds_vs_consensus
        description: Average difference in under odds compared to consensus
      
      - name: avg_over_prob_vs_consensus
        description: Average difference in over implied probability compared to consensus
      
      - name: avg_under_prob_vs_consensus
        description: Average difference in under implied probability compared to consensus
      
      - name: avg_vig_pct
        description: Average bookmaker margin (vig) percentage for this sportsbook
      
      - name: specific_line_bias
        description: Sportsbook's bias for this player-market compared to its general line pattern
      
      - name: specific_over_odds_bias
        description: Sportsbook's bias in over odds for this player-market compared to its general pattern
      
      - name: specific_under_odds_bias
        description: Sportsbook's bias in under odds for this player-market compared to its general pattern
      
      - name: potential_edge
        description: Assessment of potential betting value based on consistent sportsbook patterns
      
      - name: feature_date
        description: Date when features were calculated
        tests:
          - not_null

  - name: player_prop_market_time_series_features
    description: >
      Time-series features capturing how player prop lines evolve across games and seasons,
      identifying trends, volatility patterns, and seasonal effects.
    config:
      tags: ['betting', 'features', 'player_props', 'time_series', 'ml']
    columns:
      - name: feature_key
        description: Unique surrogate key for each player-market combination
        tests:
          - unique
          - not_null
      
      - name: player_id
        description: Unique identifier for the player
        tests:
          - not_null
      
      - name: player_name_standardized
        description: Standardized player name
        tests:
          - not_null
      
      - name: market_id
        description: Unique identifier for the betting market
        tests:
          - not_null
      
      - name: market
        description: Description of the betting market (e.g., Points O/U, Rebounds O/U)
        tests:
          - not_null
      
      - name: game_count
        description: Number of games analyzed for this player-market
      
      - name: total_games_tracked
        description: Total number of games tracked in sequence
      
      - name: first_game_date
        description: Date of first game in the analyzed period
      
      - name: last_game_date
        description: Date of last game in the analyzed period
      
      - name: total_days_tracked
        description: Number of days between first and last game
      
      - name: avg_days_between_games
        description: Average number of days between consecutive games
      
      - name: avg_abs_line_change
        description: Average absolute change in line value between consecutive games
      
      - name: stddev_line_change
        description: Standard deviation of line changes between consecutive games
      
      - name: avg_line_pct_change
        description: Average percentage change in line value between consecutive games
      
      - name: pct_line_increases
        description: Percentage of consecutive games where line increased
      
      - name: pct_line_decreases
        description: Percentage of consecutive games where line decreased
      
      - name: max_consecutive_increases
        description: Maximum number of consecutive games with line increases
      
      - name: max_consecutive_decreases
        description: Maximum number of consecutive games with line decreases
      
      - name: line_change_volatility_ratio
        description: Ratio of line change standard deviation to average change
      
      - name: line_volatility_class
        description: Classification of line volatility (Very Stable to Highly Volatile)
      
      - name: line_direction_bias
        description: Classification of directional bias in line movement
      
      - name: avg_over_odds_change
        description: Average change in over odds between consecutive games
      
      - name: avg_under_odds_change
        description: Average change in under odds between consecutive games
      
      - name: recent_trend_pattern
        description: Pattern of recent line movements (Up/Down/Stable)
      
      - name: month_to_month_line_stddev
        description: Standard deviation of average lines across months
      
      - name: month_to_month_line_range
        description: Range of average lines across months
      
      - name: active_months
        description: Months with available data for this player-market
      
      - name: line_predictability_score
        description: Score indicating how predictable line values are (0-100)
      
      - name: feature_date
        description: Date when features were calculated
        tests:
          - not_null 